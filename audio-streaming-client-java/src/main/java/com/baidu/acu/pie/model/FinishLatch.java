package com.baidu.acu.pie.model;

import com.baidu.acu.pie.client.Consumer;
import com.baidu.acu.pie.exception.GlobalException;

import java.util.concurrent.TimeUnit;

public interface FinishLatch {
    /**
     * 同步等待，直到会话结束, 或者发生了异常情况
     *
     * @return true 结束； false 不可能
     * @throws GlobalException 会话发生异常中断
     * @throws InterruptedException 会话发生异常中断
     */
    boolean await() throws GlobalException, InterruptedException;

    /**
     * 同步等待，直到会话结束 或者超时发生
     *
     * @param timeout 超时时间
     * @param unit 时间单位
     * @return true 结束； false 在指定的超时时间内， 会话还没有结束
     * @throws GlobalException 会话发生异常中断
     * @throws InterruptedException 会话发生异常中断
     */
    boolean await(long timeout, TimeUnit unit) throws GlobalException, InterruptedException;

    /**
     * 非阻塞测试会话是否已经结束, 该调用会立即返回;
     * 会话被异常中断时，调用该方法会抛出异常;
     *
     * @return true 结束； false 没有结束
     * @throws GlobalException 会话被异常中断时，抛出异常
     */
    boolean finished() throws GlobalException;

    /**
     * 一次asr stream 结束的回调，可以不设置;
     * 当会话因为失败回调的时候， consume 传入的asrException != null;
     *
     * @param callback asr结束的回调，传入的asrException表示这次asr调用是否发生了异常。如果!=null，表示异常结束；
     */
    void enableCallback(Consumer<GlobalException> callback);

}
